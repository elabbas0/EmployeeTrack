@{
    ViewData["Title"] = "Employees";
    Layout = "_DashboardLayout";
}

<!-- Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />

<!-- Flatpickr CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">

<<<<<<< HEAD
<style>
    .flatpickr-calendar {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-radius: 8px;
        border: 1px solid #e0e0e0;
    }

    .flatpickr-day.selected,
    .flatpickr-day.startRange,
    .flatpickr-day.endRange {
        background: #0d6efd;
        border-color: #0d6efd;
    }

    .flatpickr-day.inRange {
        background: rgba(13, 110, 253, 0.1);
        border-color: transparent;
    }

    .flatpickr-day.selected:hover,
    .flatpickr-day.startRange:hover,
    .flatpickr-day.endRange:hover {
        background: #0b5ed7;
        border-color: #0b5ed7;
    }

    .input-group-text {
        background-color: #f8f9fa;
        border-left: 0;
    }

    #createdDate {
        border-right: 0;
    }

    /* Select2 Bootstrap 5 styling improvements */
    .select2-container--bootstrap-5 .select2-selection {
        min-height: 38px;
    }
</style>

<div id="column_filters" class="card p-3 mb-3">
    <div class="row">
        <div class="col-md-3">
            <label class="form-label">Position</label>
            <select id="position_list" class="form-select" multiple>
                @foreach (var p in ViewBag.Positions)
                {
                    <option value="@p.Id">@p.Name</option>
                }
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Name</label>
            <input id="name_filter" class="form-control" placeholder="Search by name..." />
        </div>
        <div class="col-md-3">
            <label class="form-label">Added Date</label>
            <div class="input-group">
                <input id="createdDate" class="form-control" placeholder="Select date range" readonly />
                <span class="input-group-text">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar-range" viewBox="0 0 16 16">
                        <path d="M9 7a1 1 0 0 1 1-1h5v2h-5a1 1 0 0 1-1-1M1 9h4a1 1 0 0 1 0 2H1z" />
                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z" />
                    </svg>
                </span>
            </div>
        </div>
    </div>
    <div class="mt-3">
        <button id="filtersSearchBtn" class="btn btn-dark">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search me-1" viewBox="0 0 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
            </svg>
            Search
        </button>
        <button id="filtersResetBtn" class="btn btn-secondary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise me-1" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z" />
                <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466" />
            </svg>
            Reset
        </button>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <table id="table_data" class="table table-striped table-hover"></table>
    </div>
</div>

<!-- Create Employee Button -->
<div class="d-flex justify-content-end mt-3">
    <a href="@Url.Action("Create", "Employees")" class="btn btn-success btn-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-plus-circle me-2" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
        </svg>
        Create Employee
    </a>
</div>

<!-- Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const $parent = $('#column_filters');

        // Initialize Select2 with Bootstrap 5 theme
        $('#position_list').select2({
            theme: 'bootstrap-5',
            width: '100%',
            dropdownParent: $parent,
            placeholder: 'Select position(s)',
            allowClear: true,
            closeOnSelect: false
        });

        // Initialize Flatpickr with enhanced configuration
        flatpickr("#createdDate", {
            mode: "range",
            dateFormat: "Y-m-d",
            showMonths: 2,
            altInput: true,
            altFormat: "M j, Y",
            allowInput: false,
            closeOnSelect: false,
            locale: {
                rangeSeparator: ' to '
            },
            onReady: function(dateObj, dateStr, instance) {
                instance.calendarContainer.classList.add('shadow');
            }
        });

        function readRange() {
            const el = document.getElementById("createdDate");
            const fp = el?._flatpickr;
            if (!fp?.selectedDates?.length) return { start: null, end: null };
            const a = fp.selectedDates[0];
            const b = fp.selectedDates[1] || a;
            const format = d => d.toISOString().split('T')[0];
            return { start: format(a), end: format(b) };
=======
<table class="table table-striped">
    <thead>
        <tr>
            <th>Full name</th>
            <th>Position</th>
            <th>Nationality</th>
            <th>Start date</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var employee in Model)
        {
            <tr>
                <td>@employee.FirstName @employee.LastName</td>
                <td>@employee.Position?.Name</td>
                <td>@employee.StartDate.ToShortDateString()</td>
                <td>@employee.Country?.Name</td>
                <td>
                    <a asp-action="Delete" asp-route-id="@employee.Id" class="btn btn-sm btn-danger">Delete</a>
                </td>
            </tr>
>>>>>>> 9d8db6c58a43ab538732866f46d758c10c3ca2c4
        }

        function getFilters() {
            const date = readRange();
            return {
                PositionId: $('#position_list').val(),
                NameQuery: $('#name_filter').val(),
                CreatedStart: date.start,
                CreatedEnd: date.end
            };
        }

        function injectFilters(d) {
            const f = getFilters();

            // Convert array to comma-separated string
            const positionIds = f.PositionId;
            d['col.PositionId'] = positionIds && positionIds.length > 0
                ? positionIds.join(',')
                : '';

            d['col.NameQuery'] = f.NameQuery || '';
            d['col.CreatedStart'] = f.CreatedStart || '';
            d['col.CreatedEnd'] = f.CreatedEnd || '';
        }

        // Initialize DataTable
        const table = $('#table_data').DataTable({
            serverSide: true,
            processing: true,
            searching: false,
            ajax: {
                url: '/Employees/Load',
                type: 'POST',
                data: injectFilters
            },
            columns: [
                { data: 'name', title: 'Name' },
                { data: 'position', title: 'Position' },
                { data: 'createdAt', title: 'Created' }
            ]
        });

        // Search button handler
        $('#filtersSearchBtn').on('click', function (e) {
            e.preventDefault();
            table.ajax.reload();
        });

        // Reset button handler
        $('#filtersResetBtn').on('click', function (e) {
            e.preventDefault();
            $('#position_list').val(null).trigger('change');
            $('#name_filter').val('');
            document.getElementById('createdDate')?._flatpickr?.clear();
            table.ajax.reload();
        });

        // Search on Enter key in name filter
        $('#name_filter').on('keypress', function(e) {
            if (e.which === 13) {
                e.preventDefault();
                table.ajax.reload();
            }
        });
    });
</script>